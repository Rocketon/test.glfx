<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>three.js app</title>
    <style>
      body {
        margin: 0;
        background-color: black;
        color: aqua;
        overflow: hidden;
      }
      #canvas {
        width: 90vw;
        height: 80vh;
      }
      #pointsTable {
        position: fixed;
        display: flex;
        flex-direction: column;
        top: 0;
        right: 20px;
        align-items: center;
      }
      ::-webkit-scrollbar {
        width: 0px;
      }
    </style>
  </head>
  <body>
    <div id="pointsTable">Координаты:</div>
    <img id="image" src="test.jpg" />

    <script src="glfx.js"></script>
    <script>
      app = {
        canvas: "",
        imageW: "",
        imageH: "",
        texture: "",
        imagePoints: [],
      };

      function start(app) {
        // try to create a WebGL canvas (will fail if WebGL isn't supported)
        try {
          var canvas = fx.canvas();
          app.canvas = canvas;
        } catch (e) {
          alert(e);
          return;
        }

        let image = document.getElementById("image");
        let texture = canvas.texture(image);

        app.imageW = image.width;
        app.imageH = image.height;
        app.texture = texture;

        canvas.draw(texture).update();

        image.parentNode.insertBefore(canvas, image);
        image.parentNode.removeChild(image);

        app.imagePoints = {
          ax: 0,
          ay: 0,
          bx: app.imageW,
          by: 0,
          cx: 0,
          cy: app.imageH,
          dx: app.imageW,
          dy: app.imageH,
        };

        // coords menu
        let table = document.getElementById("pointsTable");
        for (key in app.imagePoints) {
          let positionInputBlock = document.createElement("div");

          let positionInputKey = document.createElement("span");
          positionInputKey.innerHTML = key + ": ";

          let positionInputInput = document.createElement("input");
          positionInputInput.id = key;
          positionInputInput.value = app.imagePoints[key];
          positionInputInput.type = "number";

          positionInputInput.addEventListener("input", updateData);
          positionInputBlock.appendChild(positionInputKey);
          positionInputBlock.appendChild(positionInputInput);

          table.appendChild(positionInputBlock);
        }
      }

      function updateData(e) {
        app.imagePoints[e.target.id] = e.target.value;
        updateCanvas(app);
      }

      function updateCanvas(app) {
        app.canvas
          .draw(app.texture)
          .perspective(
            [0, 0, app.imageW, 0, 0, app.imageH, app.imageW, app.imageH],
            [
              app.imagePoints.ax,
              app.imagePoints.ay,
              app.imagePoints.bx,
              app.imagePoints.by,
              app.imagePoints.cx,
              app.imagePoints.cy,
              app.imagePoints.dx,
              app.imagePoints.dy,
            ]
          )
          .update();
      }

      window.onload = function () {
        start(app);
      };
    </script>
  </body>
</html>
